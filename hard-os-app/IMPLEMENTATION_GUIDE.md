# Hard OS App - å®ç°æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Flutter çš„ä¸“ä¸šç¡¬ä»¶é€šä¿¡æ¡†æ¶ï¼Œé‡‡ç”¨ç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰æ¶æ„è®¾è®¡ï¼Œæ”¯æŒ USBã€BLEã€ç»å…¸è“ç‰™ä¸‰æ¨¡è¿æ¥ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ¶æ„å®ç°

#### ç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰
- âœ… `IHardwareTransport` æ¥å£ - å®šä¹‰ç»Ÿä¸€çš„ç¡¬ä»¶é€šä¿¡æ¥å£
- âœ… ä¸šåŠ¡å±‚å®Œå…¨æ— æ„ŸçŸ¥åº•å±‚å®ç°

#### ä¸‰ç§ä¼ è¾“åè®®å®ç°
- âœ… **BLE Transport** (`ble_transport.dart`)
  - ä½åŠŸè€—è“ç‰™å®ç°
  - æ”¯æŒ MTU ç”³è¯·ï¼ˆ512 å­—èŠ‚ï¼‰
  - è‡ªåŠ¨åˆ†åŒ…å¤„ç†
  - ç‰¹å¾å€¼è‡ªåŠ¨å‘ç°

- âœ… **Classic Bluetooth Transport** (`classic_bluetooth_transport.dart`)
  - ç»å…¸è“ç‰™å®ç°
  - SPP åè®®æ”¯æŒ
  - ç¨³å®šçš„æ•°æ®ä¼ è¾“

- âœ… **USB Transport** (`usb_transport.dart`)
  - USB ä¸²å£å®ç°
  - æ”¯æŒæ³¢ç‰¹ç‡é…ç½®
  - æ”¯æŒ FTDIã€CP210xã€CH34x èŠ¯ç‰‡

### 2. æ•°æ®å¤„ç†å±‚

#### åè®®è§£æå™¨ï¼ˆProtocol Parserï¼‰
- âœ… **å®šç•Œç¬¦åè®®è§£æå™¨** - ä½¿ç”¨ STX/ETX æ ‡è®°
- âœ… **å®šé•¿åè®®è§£æå™¨** - å›ºå®šé•¿åº¦æ•°æ®åŒ…
- âœ… **è‡ªå®šä¹‰åè®®è§£æå™¨** - ç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘
- âœ… **æ— åè®®ç›´é€šæ¨¡å¼** - åŸå§‹æ•°æ®ä¼ è¾“

### 3. ç¡¬ä»¶ç®¡ç†å™¨

#### HardwareManager åŠŸèƒ½
- âœ… å¤šåè®®å·¥å‚æ–¹æ³•
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
  - å¯é…ç½®é‡è¿æ¬¡æ•°ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰
  - å¯é…ç½®é‡è¿å»¶è¿Ÿï¼ˆé»˜è®¤ 2 ç§’ï¼‰
  
- âœ… å¿ƒè·³åŒ…æœºåˆ¶
  - å®šæœŸå‘é€å¿ƒè·³
  - æ£€æµ‹è®¾å¤‡ç¦»çº¿
  - å¯é…ç½®é—´éš”å’Œå‘½ä»¤

- âœ… ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
  - å­—èŠ‚æ•°ç»Ÿè®¡
  - å‘½ä»¤æ•°ç»Ÿè®¡
  - å¹³å‡å»¶è¿Ÿè®¡ç®—
  - é”™è¯¯è®¡æ•°

### 4. æ•°æ®æ¨¡å‹

- âœ… `ConnectionState` - è¿æ¥çŠ¶æ€æšä¸¾
- âœ… `DeviceInfo` - è®¾å¤‡ä¿¡æ¯æ¨¡å‹
- âœ… `CommandResponse` - å‘½ä»¤å“åº”æ¨¡å‹
- âœ… `TransportStats` - ä¼ è¾“ç»Ÿè®¡ä¿¡æ¯

### 5. UI ç»„ä»¶

- âœ… **ConnectionStatusWidget** - è¿æ¥çŠ¶æ€æ˜¾ç¤º
- âœ… **DeviceScannerWidget** - è®¾å¤‡æ‰«æå’Œé€‰æ‹©
- âœ… **CommandSenderWidget** - å‘½ä»¤å‘é€ï¼ˆæ”¯æŒåå…­è¿›åˆ¶ã€å­—ç¬¦ä¸²ã€æ¨¡æ¿ï¼‰
- âœ… **DataMonitorWidget** - æ•°æ®ç›‘æ§å’Œæ—¥å¿—æ˜¾ç¤º
- âœ… **HomePage** - ä¸»é¡µé¢æ•´åˆ

### 6. Android é…ç½®

- âœ… AndroidManifest.xml æƒé™é…ç½®
  - è“ç‰™æƒé™ï¼ˆBLUETOOTHã€BLUETOOTH_ADMINã€BLUETOOTH_SCANã€BLUETOOTH_CONNECTï¼‰
  - å®šä½æƒé™ï¼ˆACCESS_FINE_LOCATIONã€ACCESS_COARSE_LOCATIONï¼‰
  - USB æƒé™ï¼ˆUSB_PERMISSIONï¼‰
  - ç½‘ç»œæƒé™ï¼ˆINTERNETï¼‰

- âœ… é¡¹ç›®ç»“æ„åˆå§‹åŒ–
  - Android æ„å»ºé…ç½®
  - iOS æ„å»ºé…ç½®
  - ä»£ç åˆ†æé…ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
cd d:\myWebSite\hard-os-app
flutter pub get
```

### 2. è¿è¡Œåº”ç”¨
```bash
# åœ¨ Android çœŸæœºä¸Šè¿è¡Œ
flutter run -d 22041211AC

# æˆ–åœ¨ Windows æ¡Œé¢ä¸Šè¿è¡Œ
flutter run -d windows

# æˆ–åœ¨ Chrome æµè§ˆå™¨ä¸Šè¿è¡Œ
flutter run -d chrome
```

### 3. åº”ç”¨ç¼–è¯‘
é¦–æ¬¡ç¼–è¯‘éœ€è¦ 2-5 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€è¿æ¥æµç¨‹

```dart
// 1. è·å–ç¡¬ä»¶ç®¡ç†å™¨
final manager = context.read<HardwareManager>();

// 2. é…ç½®è‡ªåŠ¨é‡è¿
manager.configureAutoReconnect(
  enabled: true,
  maxAttempts: 3,
  delay: const Duration(seconds: 2),
);

// 3. é…ç½®å¿ƒè·³åŒ…
manager.configureHeartbeat(
  enabled: true,
  interval: const Duration(seconds: 30),
  command: '0x00',
);

// 4. åˆ›å»ºä¼ è¾“å®ç°
final transport = manager.createBleTransport();

// 5. è¿æ¥è®¾å¤‡
bool success = await manager.connect(transport, deviceId);

// 6. å‘é€å‘½ä»¤
if (success) {
  final response = await manager.sendCommandHex('cmd1', '01 02 03');
  print('å“åº”: ${response.hexString}');
}

// 7. ç›‘å¬çŠ¶æ€å˜åŒ–
manager.stateStream.listen((state) {
  print('è¿æ¥çŠ¶æ€: ${state.displayName}');
});

// 8. ç›‘å¬æ•°æ®æ¥æ”¶
manager.dataStream.listen((data) {
  print('æ¥æ”¶æ•°æ®: ${data.map((b) => b.toRadixString(16)).join(' ')}');
});

// 9. è·å–ç»Ÿè®¡ä¿¡æ¯
final stats = manager.getStats();
print('å‘é€å­—èŠ‚æ•°: ${stats?.bytesSent}');
print('å¹³å‡å»¶è¿Ÿ: ${stats?.averageLatency}ms');

// 10. æ–­å¼€è¿æ¥
await manager.disconnect();
```

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰åè®®è§£æå™¨

```dart
// å®šç•Œç¬¦åè®®ï¼ˆæ¨èï¼‰
final parser = DelimiterProtocolParser();
final transport = BleTransport(protocolParser: parser);

// å®šé•¿åè®®
final parser = FixedLengthProtocolParser(packetLength: 20);
final transport = BleTransport(protocolParser: parser);

// è‡ªå®šä¹‰åè®®
final parser = CustomProtocolParser(
  parseFunction: (buffer) {
    // è‡ªå®šä¹‰è§£æé€»è¾‘
    if (buffer.length >= 10) {
      return buffer.sublist(0, 10);
    }
    return [];
  },
);
final transport = BleTransport(protocolParser: parser);
```

### USB é…ç½®

```dart
final transport = manager.createUsbTransport(
  baudRate: 115200,
  dataBits: 8,
  stopBits: 1,
);
```

## ğŸ“Š æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           UI å±‚ï¼ˆFlutter Widgetsï¼‰       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ HomePage                         â”‚   â”‚
â”‚  â”‚ â”œâ”€ ConnectionStatusWidget        â”‚   â”‚
â”‚  â”‚ â”œâ”€ DeviceScannerWidget           â”‚   â”‚
â”‚  â”‚ â”œâ”€ CommandSenderWidget           â”‚   â”‚
â”‚  â”‚ â””â”€ DataMonitorWidget             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ä¸šåŠ¡å±‚ï¼ˆHardwareManagerï¼‰           â”‚
â”‚  â”œâ”€ è‡ªåŠ¨é‡è¿ç®¡ç†                        â”‚
â”‚  â”œâ”€ å¿ƒè·³åŒ…ç®¡ç†                          â”‚
â”‚  â”œâ”€ ç»Ÿè®¡ä¿¡æ¯æ”¶é›†                        â”‚
â”‚  â””â”€ æµç®¡ç†ï¼ˆState/Data/Responseï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      HAL æ¥å£å±‚ï¼ˆIHardwareTransportï¼‰    â”‚
â”‚  â”œâ”€ connect()                           â”‚
â”‚  â”œâ”€ disconnect()                        â”‚
â”‚  â”œâ”€ sendCommand()                       â”‚
â”‚  â”œâ”€ receiveStream                       â”‚
â”‚  â””â”€ stateStream                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ä¼ è¾“å±‚å®ç°                          â”‚
â”‚  â”œâ”€ BleTransport                        â”‚
â”‚  â”œâ”€ ClassicBluetoothTransport           â”‚
â”‚  â””â”€ UsbTransport                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åè®®è§£æå±‚ï¼ˆProtocolParserï¼‰        â”‚
â”‚  â”œâ”€ DelimiterProtocolParser             â”‚
â”‚  â”œâ”€ FixedLengthProtocolParser           â”‚
â”‚  â”œâ”€ CustomProtocolParser                â”‚
â”‚  â””â”€ NoProtocolParser                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç¡¬ä»¶è®¾å¤‡                            â”‚
â”‚  â”œâ”€ BLE è®¾å¤‡                            â”‚
â”‚  â”œâ”€ ç»å…¸è“ç‰™è®¾å¤‡                        â”‚
â”‚  â””â”€ USB ä¸²å£è®¾å¤‡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å¤šåè®®æ”¯æŒ
- BLEï¼ˆä½åŠŸè€—è“ç‰™ï¼‰- çœç”µï¼Œå¶å‘æŒ‡ä»¤
- ç»å…¸è“ç‰™ - ç¨³å®šï¼Œé¢‘ç¹äº¤äº’
- USB ä¸²å£ - æœ€ç¨³å®šï¼Œå·¥ä¸šåœºæ™¯

### 2. æ•°æ®ç²˜åŒ…å¤„ç†
- å®šç•Œç¬¦åè®®ï¼ˆSTX/ETXï¼‰
- å®šé•¿åè®®
- è‡ªå®šä¹‰åè®®

### 3. è‡ªåŠ¨é‡è¿
- ç›‘å¬è¿æ¥æ–­å¼€
- è‡ªåŠ¨å°è¯•é‡è¿
- å¯é…ç½®å‚æ•°

### 4. å¿ƒè·³åŒ…
- å®šæœŸå‘é€
- æ£€æµ‹ç¦»çº¿
- å¯é…ç½®å‘½ä»¤

### 5. å®Œæ•´æ—¥å¿—
- æ“ä½œæ—¥å¿—
- åå…­è¿›åˆ¶æ˜¾ç¤º
- ç»Ÿè®¡ä¿¡æ¯

## âš ï¸ å¸¸è§é—®é¢˜

### BLE è¿æ¥å¤±è´¥
- æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒ BLE
- ç¡®ä¿å·²ç”³è¯· MTU
- éªŒè¯ UUID æ˜¯å¦æ­£ç¡®

### ç»å…¸è“ç‰™æ•°æ®ä¸¢å¤±
- ç¡®ä¿è®¾å¤‡å·²é…å¯¹
- æ£€æŸ¥è¿æ¥æ˜¯å¦åœ¨åå°çº¿ç¨‹
- è€ƒè™‘é™ä½å‘é€é¢‘ç‡

### USB è®¾å¤‡æ— æ³•è¯†åˆ«
- æ£€æŸ¥ OTG æ˜¯å¦å¯ç”¨
- éªŒè¯é©±åŠ¨ç¨‹åº
- å°è¯•é‡æ–°æ’æ‹”

### æ•°æ®ç²˜åŒ…
- ä½¿ç”¨å®šç•Œç¬¦åè®®
- æˆ–å®ç°å®šé•¿åè®®
- æˆ–è‡ªå®šä¹‰è§£æé€»è¾‘

## ğŸ“ é¡¹ç›®ç»“æ„

```
hard-os-app/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ interfaces/
â”‚   â”‚   â”‚   â””â”€â”€ hardware_transport.dart
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ connection_state.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ device_info.dart
â”‚   â”‚   â”‚   â””â”€â”€ command_response.dart
â”‚   â”‚   â”œâ”€â”€ protocol/
â”‚   â”‚   â”‚   â””â”€â”€ protocol_parser.dart
â”‚   â”‚   â”œâ”€â”€ transports/
â”‚   â”‚   â”‚   â”œâ”€â”€ ble_transport.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ classic_bluetooth_transport.dart
â”‚   â”‚   â”‚   â””â”€â”€ usb_transport.dart
â”‚   â”‚   â””â”€â”€ hardware_manager.dart
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ home_page.dart
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ connection_status.dart
â”‚   â”‚   â”œâ”€â”€ device_scanner.dart
â”‚   â”‚   â”œâ”€â”€ command_sender.dart
â”‚   â”‚   â””â”€â”€ data_monitor.dart
â”‚   â””â”€â”€ main.dart
â”œâ”€â”€ android/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ main/
â”‚   â”‚   â”‚       â””â”€â”€ AndroidManifest.xml
â”‚   â”‚   â””â”€â”€ build.gradle.kts
â”‚   â””â”€â”€ build.gradle.kts
â”œâ”€â”€ ios/
â”‚   â””â”€â”€ Runner/
â”œâ”€â”€ pubspec.yaml
â”œâ”€â”€ analysis_options.yaml
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

## ğŸ” å®‰å…¨å»ºè®®

1. **æƒé™ç®¡ç†**
   - å®ç°æƒé™å¼•å¯¼é¡µ
   - åŠ¨æ€ç”³è¯·æƒé™
   - å¤„ç†æƒé™æ‹’ç»

2. **æ•°æ®å®‰å…¨**
   - éªŒè¯æ¥æ”¶æ•°æ®
   - å®ç°æ•°æ®åŠ å¯†
   - è®°å½•æ•æ„Ÿæ“ä½œ

3. **é”™è¯¯å¤„ç†**
   - å®Œå–„å¼‚å¸¸æ•è·
   - æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
   - å®ç°æ—¥å¿—ä¸ŠæŠ¥

## ğŸ“ åç»­å¼€å‘è®¡åˆ’

- [ ] æƒé™å¼•å¯¼é¡µé¢
- [ ] æ•°æ®åŠ å¯†æ”¯æŒ
- [ ] æ—¥å¿—å¯¼å‡ºåŠŸèƒ½
- [ ] è®¾å¤‡é…å¯¹ç®¡ç†
- [ ] å›ºä»¶å‡çº§æ”¯æŒ
- [ ] ç¦»çº¿æ•°æ®ç¼“å­˜
- [ ] äº‘åŒæ­¥åŠŸèƒ½
- [ ] æ€§èƒ½ä¼˜åŒ–

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

---

**ç¥ä½ ç¡¬ä»¶å¼€å‘é¡ºåˆ©ï¼** ğŸš€
