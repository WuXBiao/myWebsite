# Hard OS App - 移动端测试工具指南

## 🧪 测试工具概述

Hard OS App 内置了完整的可视化测试工具，可以直接在移动设备上进行硬件通信测试，无需额外的测试工具。

## 🚀 如何访问测试工具

### 方法 1：通过主页面
1. 打开应用
2. 点击右上角的 **🐛 测试工具** 按钮
3. 进入测试工具页面

### 方法 2：直接导航
在代码中直接导航到测试页面：
```dart
Navigator.of(context).push(
  MaterialPageRoute(builder: (_) => const TestPage()),
);
```

## 📋 测试工具功能

### 标签 1：连接测试

#### 传输方式选择
- **测试 BLE 连接** - 创建 BLE 传输对象并验证状态
- **测试经典蓝牙连接** - 创建经典蓝牙传输对象并验证状态
- **测试 USB 连接** - 创建 USB 传输对象并验证状态

#### 自动重连配置
- **启用自动重连** - 配置自动重连（3 次，2 秒延迟）
- **禁用自动重连** - 关闭自动重连功能

#### 心跳包配置
- **启用心跳包** - 配置心跳包（30 秒间隔，0x00 命令）
- **禁用心跳包** - 关闭心跳包功能

**使用场景：**
- 验证传输对象创建
- 测试自动重连功能
- 验证心跳包机制

---

### 标签 2：命令测试

#### 命令模板测试
- **查询设备状态** (01 00 00) - 查询设备当前状态
- **启动设备** (02 01 00) - 启动设备
- **停止设备** (02 00 00) - 停止设备
- **重置设备** (03 00 00) - 重置设备

#### 自定义命令
- **发送: FF FF FF (测试)** - 发送自定义测试命令

**使用场景：**
- 验证命令发送功能
- 测试设备响应
- 验证命令-响应流程

**注意：** 需要设备已连接才能发送命令

---

### 标签 3：数据测试

#### 数据粘包测试
- **快速发送 10 个命令** - 快速连续发送 10 个命令，测试数据粘包处理
- **发送大数据包 (256 字节)** - 发送 256 字节的大数据包
- **清空接收缓冲区** - 清空协议解析器的缓冲区

#### 流监听测试
- **开始监听数据流** - 监听硬件返回的数据
- **开始监听状态流** - 监听连接状态变化

**使用场景：**
- 测试数据粘包处理
- 验证大数据包传输
- 验证流监听功能

---

### 标签 4：性能测试

#### 吞吐量测试
- **测试: 100 个命令** - 快速发送 100 个命令，测试吞吐量
  - 显示总耗时
  - 显示成功/失败数
  - 计算吞吐量（命令/秒）

#### 延迟分析
- **测试: 延迟分析** - 发送 20 个命令，分析响应延迟
  - 显示最小延迟
  - 显示最大延迟
  - 显示平均延迟

#### 统计信息
- **显示统计信息** - 显示传输统计数据
  - 发送/接收字节数
  - 发送/接收命令数
  - 连接次数
  - 平均延迟
  - 错误次数

- **重置统计信息** - 清空统计数据

**使用场景：**
- 评估硬件通信性能
- 分析响应延迟
- 监控传输统计

---

### 标签 5：日志

#### 日志显示
- 实时显示所有测试操作的日志
- 最多保存 200 条日志记录
- 自动滚动到最新日志

#### 日志操作
- **清空** - 清空所有日志
- **复制日志** - 复制所有日志到剪贴板
- **新建会话** - 开始新的测试会话

**使用场景：**
- 查看测试执行过程
- 调试问题
- 导出测试结果

---

## 🎯 典型测试流程

### 测试流程 1：基础连接测试

1. 进入 **连接测试** 标签
2. 点击 **测试 BLE 连接** 按钮
3. 查看日志，验证传输对象创建成功
4. 点击 **启用自动重连** 按钮
5. 点击 **启用心跳包** 按钮
6. 在日志中验证配置成功

**预期结果：**
```
✓ BLE 传输对象已创建
状态: 未连接
✓ 自动重连已启用
✓ 心跳包已启用
```

### 测试流程 2：命令发送测试

1. 确保设备已连接
2. 进入 **命令测试** 标签
3. 点击 **发送: 查询设备状态** 按钮
4. 查看日志，验证收到响应
5. 记录响应延迟

**预期结果：**
```
发送命令: 查询设备状态 (01 00 00)
✓ 收到响应: 01 02 03 04 05
  延迟: 45ms
```

### 测试流程 3：数据粘包测试

1. 确保设备已连接
2. 进入 **数据测试** 标签
3. 点击 **快速发送 10 个命令** 按钮
4. 等待测试完成
5. 验证所有命令都收到了响应

**预期结果：**
```
开始快速发送 10 个命令...
✓ 命令 0 响应: ...
✓ 命令 1 响应: ...
...
✓ 快速发送测试完成
```

### 测试流程 4：性能测试

1. 确保设备已连接
2. 进入 **性能测试** 标签
3. 点击 **测试: 100 个命令** 按钮
4. 等待测试完成
5. 记录吞吐量数据

**预期结果：**
```
开始吞吐量测试: 100 个命令...
✓ 吞吐量测试完成
  总耗时: 15 秒
  成功: 100
  失败: 0
  吞吐量: 6.67 命令/秒
```

### 测试流程 5：完整测试套件

1. 进入 **连接测试** 标签，测试传输方式
2. 进入 **命令测试** 标签，测试命令发送
3. 进入 **数据测试** 标签，测试数据处理
4. 进入 **性能测试** 标签，测试性能指标
5. 进入 **日志** 标签，导出测试结果

---

## 📊 日志解析

### 日志格式

```
[时间戳] 日志内容
```

### 日志符号

| 符号 | 含义 |
|------|------|
| ✓ | 操作成功 |
| ✗ | 操作失败 |
| ⚠ | 警告信息 |
| 📥 | 接收数据 |
| 🔄 | 状态变化 |
| 📊 | 统计信息 |

### 日志示例

```
[2024-01-14 14:30:00] 开始 BLE 连接测试...
[2024-01-14 14:30:01] ✓ BLE 传输对象已创建
[2024-01-14 14:30:01] 状态: 未连接
[2024-01-14 14:30:02] 配置自动重连...
[2024-01-14 14:30:02] ✓ 自动重连已启用
[2024-01-14 14:30:02]   - 最大重连次数: 3
[2024-01-14 14:30:02]   - 重连延迟: 2 秒
```

---

## 🔍 故障排查

### 问题 1：命令发送失败

**症状：** 点击命令按钮后显示 "⚠ 设备未连接"

**原因：** 设备未连接

**解决方案：**
1. 先进行连接测试
2. 确保设备已连接
3. 再尝试发送命令

### 问题 2：没有收到响应

**症状：** 发送命令后没有响应

**原因：** 
- 设备未正确连接
- 设备不支持该命令
- 协议解析器配置不正确

**解决方案：**
1. 检查连接状态
2. 尝试发送其他命令
3. 检查日志中的错误信息

### 问题 3：数据粘包

**症状：** 快速发送多个命令后，响应数据混乱

**原因：** 协议解析器未正确处理数据包

**解决方案：**
1. 使用定界符协议解析器
2. 或实现定长协议解析器
3. 或自定义协议解析逻辑

### 问题 4：性能指标异常

**症状：** 吞吐量很低或延迟很高

**原因：**
- 硬件连接不稳定
- 设备处理能力有限
- 网络干扰

**解决方案：**
1. 检查硬件连接
2. 减少发送频率
3. 更换环境或设备

---

## 💡 最佳实践

### 1. 定期测试
- 每次更新代码后运行完整测试套件
- 在发布前进行性能测试
- 定期检查统计信息

### 2. 记录测试结果
- 复制日志并保存
- 记录性能基准数据
- 跟踪问题和改进

### 3. 多设备测试
- 在不同的 Android 版本上测试
- 在不同的硬件设备上测试
- 在不同的网络环境中测试

### 4. 压力测试
- 快速发送大量命令
- 发送大数据包
- 长时间运行测试

### 5. 边界条件测试
- 测试最小数据包
- 测试最大数据包
- 测试无效命令

---

## 📈 性能基准

### 推荐的性能指标

| 指标 | BLE | 经典蓝牙 | USB |
|------|-----|---------|-----|
| 吞吐量 | 1-5 cmd/s | 10-50 cmd/s | 100+ cmd/s |
| 平均延迟 | 50-200ms | 10-50ms | 1-10ms |
| 最大延迟 | 500ms | 200ms | 50ms |
| 成功率 | 95%+ | 99%+ | 99.9%+ |

---

## 🔗 相关资源

- [IMPLEMENTATION_GUIDE.md](IMPLEMENTATION_GUIDE.md) - 实现指南
- [TEST_GUIDE.md](TEST_GUIDE.md) - 单元测试指南
- [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md) - 部署指南
- [README.md](README.md) - 项目概述

---

**祝测试顺利！** ✨
